# ğŸ”§ SSH è¿æ¥è¢«æ‹’ç» - å®Œæ•´è§£å†³æ–¹æ¡ˆ

## ğŸ“Š å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
1. âœ… ä»£ç å·²æ¨é€åˆ° GitHub
2. âœ… **å‰ç«¯ Docker é•œåƒå·²æˆåŠŸæ„å»º** ğŸ‰
3. âœ… blog.service å·²åˆ é™¤ï¼ˆä¸å†å¯¼è‡´é‡å¯å¾ªç¯ï¼‰

### ğŸ”„ å½“å‰é—®é¢˜
- **SSH è¿æ¥è¢«æ‹’ç»** - å¯èƒ½åŸå› ï¼š
  - Docker æ„å»ºä»åœ¨è¿›è¡Œä¸­ï¼Œå ç”¨å¤§é‡èµ„æº
  - æœåŠ¡å™¨æ­£åœ¨è¿›è¡Œå…¶ä»–æ“ä½œ
  - SSH æœåŠ¡é…ç½®é—®é¢˜

---

## ğŸ¯ ç«‹å³æ‰§è¡Œçš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ Aï¼šé€šè¿‡è…¾è®¯äº‘æ§åˆ¶å°æ“ä½œï¼ˆæ¨èï¼‰

#### æ­¥éª¤ 1ï¼šç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
1. ç™»å½•ï¼šhttps://console.cloud.tencent.com/
2. è¿›å…¥ **äº‘æœåŠ¡å™¨ CVM** â†’ é€‰æ‹©å®ä¾‹ï¼š114.132.201.154
3. ç‚¹å‡» **VNC ç™»å½•** æˆ– **Web Shell**

#### æ­¥éª¤ 2ï¼šæ£€æŸ¥æ„å»ºçŠ¶æ€
åœ¨ VNC/Web Shell ä¸­æ‰§è¡Œï¼š

```bash
# æ£€æŸ¥ Docker è¿›ç¨‹
ps aux | grep docker

# æ£€æŸ¥å½“å‰ç›®å½•
cd /var/blog

# æŸ¥çœ‹ Docker å®¹å™¨çŠ¶æ€
docker compose ps -a

# å¦‚æœæ„å»ºå¡ä½ï¼Œç»ˆæ­¢å®ƒ
docker compose down

# é‡æ–°æ„å»º
docker compose build
```

#### æ­¥éª¤ 3ï¼šå¦‚æœæ„å»ºæˆåŠŸï¼Œå¯åŠ¨æœåŠ¡

```bash
cd /var/blog

# å¯åŠ¨æœåŠ¡
docker compose up -d

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps
```

#### æ­¥éª¤ 4ï¼šåˆå§‹åŒ–æ•°æ®åº“

```bash
# ç”Ÿæˆ Prisma Client
docker compose exec -T backend pnpm db:generate

# æ¨é€æ•°æ®åº“ç»“æ„
docker compose exec -T backend pnpm db:push
```

#### æ­¥éª¤ 5ï¼šéªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker compose ps

# æŸ¥çœ‹æ—¥å¿—
docker compose logs -f
```

---

### æ–¹æ¡ˆ Bï¼šç­‰å¾…æœåŠ¡å™¨æ¢å¤è¿æ¥ï¼ˆ10-15 åˆ†é’Ÿï¼‰

**ç­‰å¾…åŸå› **ï¼š
- Docker æ„å»ºå¯èƒ½è¿˜åœ¨è¿›è¡Œä¸­ï¼ˆå‰ç«¯å·²å®Œæˆï¼Œåç«¯å¯èƒ½è¿˜åœ¨è¿›è¡Œï¼‰
- æœåŠ¡å™¨å¯èƒ½åœ¨è¿›è¡Œå…¶ä»–ç³»ç»Ÿç»´æŠ¤

**ç­‰å¾…åæ‰§è¡Œ**ï¼š

```powershell
# 1. ç­‰å¾… 15-30 åˆ†é’Ÿ
Start-Sleep -Seconds 30

# 2. å°è¯•é‡æ–°è¿æ¥
ssh -i ~/.ssh/github_deploy lighthouse@114.132.201.154 "cd /var/blog && docker compose ps"

# 3. å¦‚æœè¿æ¥æˆåŠŸï¼Œæ‰§è¡Œéƒ¨ç½²
.\deploy-complete.sh
```

---

### æ–¹æ¡ˆ Cï¼šæ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€ï¼ˆåœ¨æ§åˆ¶å°ï¼‰

**åœ¨è…¾è®¯äº‘æ§åˆ¶å°** â†’ é€‰æ‹©å®ä¾‹ â†’ **VNC ç™»å½•**ï¼š

```bash
# æŸ¥çœ‹å½“å‰è¿›ç¨‹
top
# æŒ‰ 'q' é€€å‡º

# æŸ¥çœ‹ SSH æœåŠ¡çŠ¶æ€
sudo systemctl status sshd

# å¦‚æœ SSH æœåŠ¡æœªè¿è¡Œï¼Œå¯åŠ¨å®ƒ
sudo systemctl start sshd
```

---

## ğŸ”§ åç«¯æ„å»ºå¤±è´¥çš„ä¿®å¤

### é—®é¢˜åŸå› 
åç«¯æ„å»ºå¤±è´¥æ˜¯å› ä¸º `husky` (Git hooks å·¥å…·) åœ¨æœåŠ¡å™¨ä¸Šæ‰¾ä¸åˆ°ã€‚

### ä¿®å¤æ–¹æ³•

#### æ–¹æ³• 1ï¼šä¿®æ”¹ Dockerfile è·³è¿‡ husky æ£€æŸ¥

**åœ¨æœåŠ¡å™¨ä¸Š**ï¼ˆé€šè¿‡ VNC/Web Shellï¼‰ï¼š

```bash
cd /var/blog

# æŸ¥çœ‹ Dockerfile
cat packages/backend/Dockerfile

# å¦‚æœçœ‹åˆ° npm install ç›¸å…³çš„å‘½ä»¤ï¼Œå¯ä»¥è·³è¿‡ postinstall è„šæœ¬çš„é”™è¯¯
```

#### æ–¹æ³• 2ï¼šä¿®æ”¹ package.json

```bash
cd /var/blog/packages/backend

# å¤‡ä»½ package.json
cp package.json package.json.bak

# ç§»é™¤ husky ä¾èµ–ï¼ˆä» devDependencies ä¸­åˆ é™¤ "husky": "9.1.7"ï¼‰
vi package.json

# é‡æ–°æ„å»º
cd /var/blog
docker compose down
docker compose build
```

#### æ–¹æ³• 3ï¼šä½¿ç”¨æ›´ç®€å•çš„æ„å»ºè„šæœ¬

```bash
cd /var/blog

# æ‰‹åŠ¨å¯åŠ¨åç«¯å®¹å™¨ï¼ˆè·³è¿‡æ„å»ºï¼‰
docker compose up -d --no-build

# å¦‚æœé•œåƒå·²å­˜åœ¨ï¼Œç›´æ¥å¯åŠ¨
docker compose up -d
```

---

## ğŸ“ ä¸´æ—¶å¯åŠ¨æ–¹æ¡ˆï¼ˆå¦‚æœæ„å»ºæŒç»­å¤±è´¥ï¼‰

### æ–¹æ³•ï¼šä½¿ç”¨å·²æœ‰çš„é•œåƒ

**åœ¨æ§åˆ¶å°æ‰§è¡Œ**ï¼š

```bash
cd /var/blog

# æŸ¥çœ‹å·²æœ‰é•œåƒ
docker images

# å¦‚æœ blog-backend é•œåƒå­˜åœ¨ï¼Œç›´æ¥å¯åŠ¨
docker compose up -d
```

---

## ğŸ¯ å¿«é€Ÿæ¢å¤æ­¥éª¤

### æœ€å¿«çš„æ–¹æ³•ï¼ˆ1-2 åˆ†é’Ÿï¼‰

1. **ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°** â†’ VNC ç™»å½•
2. æ£€æŸ¥ Docker è¿›ç¨‹ï¼š`ps aux | grep docker`
3. ç»ˆæ­¢å¡ä½çš„æ„å»ºï¼š`docker compose down`
4. é‡æ–°æ„å»ºï¼š`docker compose build --no-cache`
5. å¯åŠ¨æœåŠ¡ï¼š`docker compose up -d`
6. åˆå§‹åŒ–æ•°æ®åº“ï¼š`docker compose exec -T backend pnpm db:generate && docker compose exec -t backend pnpm db:push`

---

## ğŸ“Š æ„å»ºçŠ¶æ€æ€»ç»“

### å‰ç«¯ âœ…
- âœ… ä¾èµ–å®‰è£…æˆåŠŸ
- âœ… æ„å»ºæˆåŠŸ
- âœ… é•œåƒå·²åˆ›å»ºï¼š`blog-frontend`

### åç«¯ â³
- âœ… ä¾èµ–å®‰è£…æˆåŠŸ
- âŒ ç”Ÿäº§ä¾èµ–å®‰è£…å¤±è´¥ï¼ˆç¼ºå°‘ huskyï¼‰â†’ **å¯ä¿®å¤**

---

## ğŸ”§ åç«¯æ„å»ºä¿®å¤æ–¹æ³•

### æœ€ç®€å•çš„æ–¹æ³•ï¼šä½¿ç”¨å·²æ„å»ºçš„é•œåƒ

**åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ**ï¼ˆé€šè¿‡ VNCï¼‰ï¼š

```bash
cd /var/blog

# æŸ¥çœ‹å·²æœ‰é•œåƒ
docker images | grep blog

# å¦‚æœæœ‰ blog-backend é•œåƒï¼Œç›´æ¥å¯åŠ¨
docker compose up -d

# åˆå§‹åŒ–æ•°æ®åº“
docker compose exec -T backend pnpm db:generate
docker compose exec -T backend pnpm db:push
```

### å¦‚æœæ²¡æœ‰åç«¯é•œåƒï¼Œé‡æ–°æ„å»ºï¼ˆä¿®å¤ç‰ˆï¼‰

```bash
cd /var/blog

# 1. æ¸…ç†ç¼“å­˜
docker system prune -f

# 2. åˆ é™¤å¤±è´¥çš„ä¸­é—´å±‚é•œåƒ
docker images

# 3. é‡æ–°æ„å»º
docker compose build --no-cache
```

---

## ğŸš€ å®Œæˆåçš„éªŒè¯

### æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
docker compose ps
```

### è®¿é—®åšå®¢

**å‰ç«¯**ï¼šhttp://114.132.201.154:3000
**åç«¯**ï¼šhttp://114.132.202.154:3001

### æŸ¥çœ‹æ—¥å¿—

```bash
docker compose logs -f
```

---

## ğŸ“ å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±è´¥

### è”ç³»è…¾è®¯äº‘æŠ€æœ¯æ”¯æŒ

1. æäº¤å·¥å•ï¼šhttps://console.cloud.tencent.com/ticket
2. é—®é¢˜æè¿°ï¼šDocker æ„å»ºå¤±è´¥ï¼ŒSSH æ— æ³•è¿æ¥
3. æä¾›å®ä¾‹ IDï¼š114.132.201.154

### é‡å¯æœåŠ¡å™¨ï¼ˆæœ€åæ‰‹æ®µï¼‰

**åœ¨è…¾è®¯äº‘æ§åˆ¶å°**ï¼š
1. åœæ­¢æœåŠ¡å™¨
2. é‡æ–°å¯åŠ¨æœåŠ¡å™¨
3. ç­‰å¾…å¯åŠ¨å®Œæˆåï¼ŒSSH è¿æ¥å¹¶æ‰§è¡Œéƒ¨ç½²

---

## ğŸ“ å…³é”®æç¤º

### 1. ä¸è¦æ‰‹åŠ¨é‡å¯æœåŠ¡å™¨
   - Docker æ„å»ºå¯èƒ½è¿˜åœ¨è¿›è¡Œä¸­
   - æ‰‹åŠ¨é‡å¯ä¼šä¸­æ–­æ„å»ºè¿‡ç¨‹

### 2. å‰ç«¯å·²ç»æˆåŠŸ
   - blog-frontend é•œåƒå·²åˆ›å»º
   - å¦‚æœæ— æ³•é‡æ–°æ„å»ºï¼Œå¯ä»¥å…ˆç”¨å‰ç«¯

### 3. åç«¯é—®é¢˜å¯ä¿®å¤
   - åªæ˜¯ç¼ºå°‘ huskyï¼ˆéå…³é”®ä¾èµ–ï¼‰
   - ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½

---

**ä¸‹ä¸€æ­¥**ï¼šé€šè¿‡è…¾è®¯äº‘æ§åˆ¶å°æ‰§è¡Œ "å¿«é€Ÿæ¢å¤æ­¥éª¤"

**æˆ–**ï¼šç­‰å¾… 10-15 åˆ†é’Ÿåï¼ŒSSH è¿æ¥æ¢å¤åæ‰§è¡Œ `.\deploy-complete.sh`
